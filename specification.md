# Google Apps Script 自動予約管理システム仕様書

## 1. システム概要

### 1.1 目的
Googleカレンダーと連携した自動予約管理システムを構築し、予約の受付、確認メール送信、リマインダー通知を自動化することで、予約管理業務の効率化を図る。

### 1.2 主な機能
- 予約フォームからの予約受付
- Googleカレンダーへの予約の自動登録
- 予約者への自動確認メール送信
- 予約日近づく際の自動リマインダー通知
- 予約のキャンセル・変更処理
- 管理者向け予約状況確認ダッシュボード

## 2. システム構成

### 2.1 使用技術
- Google Apps Script (GAS)
- Google Forms (予約フォーム)
- Google Spreadsheet (予約データ管理)
- Google Calendar API (カレンダー連携)
- Gmail API (メール送信)

### 2.2 システムフロー
1. ユーザーが予約フォームから予約情報を送信
2. 送信データがスプレッドシートに記録
3. GASトリガーが予約データを検知
4. Googleカレンダーに予約イベントを作成
5. 予約者に確認メールを自動送信
6. 予約日の指定日前にリマインダーメールを自動送信

## 3. 詳細機能仕様

### 3.1 予約フォーム
#### 3.1.1 入力項目
- 氏名（必須）
- メールアドレス（必須）
- 電話番号（必須）
- 希望日時（必須）
- 予約内容/目的（必須）
- 備考（任意）

#### 3.1.2 予約フォーム検証
- 日時の入力形式チェック
- 営業時間内かどうかの検証
- 既存予約との重複チェック

### 3.2 予約データ管理（スプレッドシート）
#### 3.2.1 データ構造
- 予約ID（自動生成）
- 予約日時
- 氏名
- メールアドレス
- 電話番号
- 予約内容/目的
- 備考
- 状態（確定/キャンセル/変更）
- Googleカレンダーイベントリンク
- 確認メール送信状況
- リマインダー送信状況

#### 3.2.2 スプレッドシート機能
- 予約状況一覧表示
- 予約状態フィルタリング
- 日付範囲検索

### 3.3 Googleカレンダー連携
#### 3.3.1 カレンダーイベント作成
- イベントタイトル：「[予約] 氏名 - 予約内容」形式
- 日時：予約フォームで指定された日時
- 説明：予約詳細情報（氏名、連絡先など）
- 場所：予約場所（設定されている場合）
- 通知設定：管理者向けに予約10分前に通知

#### 3.3.2 カレンダー更新
- 予約変更時の自動更新
- キャンセル時のイベント削除または状態変更

### 3.4 メール自動送信
#### 3.4.1 予約確認メール
- 送信タイミング：予約フォーム送信直後
- 件名：「【予約確認】予約内容のご確認」
- 本文内容：
  - 予約者氏名
  - 予約日時
  - 予約内容/目的
  - キャンセル・変更方法の案内
  - 問い合わせ先情報

#### 3.4.2 リマインダーメール
- 送信タイミング：予約日の3日前（カスタマイズ可能）
- 件名：「【リマインダー】ご予約日が近づいています」
- 本文内容：
  - 予約者氏名
  - 予約日時
  - 予約内容/目的
  - キャンセル・変更方法の案内
  - 準備事項や注意点（必要な場合）

#### 3.4.3 キャンセル・変更確認メール
- 送信タイミング：予約変更・キャンセル処理後
- 件名：「【予約変更/キャンセル確認】」
- 本文内容：
  - 処理内容（変更またはキャンセル）
  - 変更前/変更後の情報（変更の場合）
  - 確認事項

### 3.5 キャンセル・変更処理
#### 3.5.1 キャンセルフォーム
- 予約IDまたはメールアドレスで予約を検索
- キャンセル理由（任意）
- キャンセル確認

#### 3.5.2 変更フォーム
- 予約IDまたはメールアドレスで予約を検索
- 変更したい項目の入力
- 変更確認

### 3.6 管理者ダッシュボード
#### 3.6.1 表示機能
- 日次/週次/月次予約状況
- 予約統計（予約数、キャンセル率など）
- 予約検索機能
- フィルタリング（状態、日付範囲など）

#### 3.6.2 管理機能
- 予約の手動追加
- 予約情報の編集
- 予約のキャンセル
- メール再送信

## 4. トリガー設定

### 4.1 定期実行トリガー
- 予約フォーム送信時トリガー：予約データ処理
- 毎日深夜実行トリガー：リマインダーメール送信確認
- 毎時実行トリガー：カレンダーとの同期確認

### 4.2 イベントトリガー
- スプレッドシート編集時トリガー：予約変更時の処理
- フォーム送信時トリガー：予約・キャンセル処理

## 5. エラー処理

### 5.1 エラーログ
- エラー発生時のログ記録（スプレッドシートの専用シート）
- エラー内容、発生時刻、関連予約情報の記録

### 5.2 エラー通知
- 重要エラー発生時の管理者へのメール通知
- 継続的なエラー監視と報告機能

## 6. セキュリティ考慮事項

### 6.1 データ保護
- 個人情報の適切な取り扱い
- アクセス権限の適切な設定

### 6.2 認証・認可
- スクリプトの実行権限設定
- 管理者ダッシュボードへのアクセス制限

## 7. カスタマイズオプション

### 7.1 設定項目
- 営業時間設定
- 予約間隔設定（最小予約時間単位）
- リマインダー送信タイミング設定
- メールテンプレートカスタマイズ
- カレンダー表示設定

### 7.2 拡張機能オプション
- SMS通知連携
- 予約可能時間の動的表示
- 定期予約機能
- 複数カレンダー対応

## 8. 導入・設定手順

### 8.1 初期設定
1. スプレッドシートの作成とデータ構造設定
2. Googleフォームの作成と連携
3. GASスクリプトの導入
4. Googleカレンダーの連携設定
5. メールテンプレートの設定

### 8.2 権限設定
- 必要なAPI権限の付与
- スクリプト実行権限の設定
- トリガーの設定

## 9. 運用・保守

### 9.1 定期メンテナンス
- スクリプトの動作確認
- データバックアップ
- エラーログの確認と対応

### 9.2 トラブルシューティング
- 一般的なエラーとその対処法
- サポート連絡先
